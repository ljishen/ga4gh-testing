- name: download ga4gh data
  unarchive:
    src: "{{ data_source_url }}"
    dest: "{{ data_source_path }}"
    copy: no
    creates: "{{ data_source_path }}/{{ data_source_folder }}"

# Temporary disable this resource until server docker image updated
#- name: download NCBI37 Reference set
#  unarchive:
#    src: "{{ ncbi37_ref_set_url }}"
#    dest: "{{ data_source_path }}/{{ data_source_folder }}"
#    copy: no
#    creates: "{{ data_source_path }}/{{ data_source_folder }}/referenceSets/NCBI37"

- name: download sequence annotations db
  get_url:
    url: "{{ sequence_annotations_url }}"
    dest: "{{ data_source_path }}/{{ data_source_folder }}/datasets/1kg-p3-subset/sequenceAnnotations/gencode_v24lift37.db"
    force: no

- name: start ga4gh reference server
  docker:
    image: afirth/ga4gh-server
    name: ga4gh_server
    state: reloaded
    volumes: "{{ data_source_path }}/{{ data_source_folder }}:/data:ro"
    ports: 80:80
    env:
      GA4GH_DEBUG: True
      GA4GH_DATA_SOURCE: /data
